#
# Stage 1: Build the application with JDK 21 and Maven
#
FROM eclipse-temurin:21-jdk-alpine AS build
WORKDIR /app

# Copy the Maven build files and dependencies for caching
COPY .mvn/ .mvn
COPY mvnw pom.xml ./
RUN ./mvnw dependency:go-offline

# Copy the source code and build the final JAR file
COPY src ./src
RUN ./mvnw clean package -DskipTests

#
# Stage 2: Create the final lightweight, production-ready image
# This image only contains the necessary JRE to run your app.
#
FROM openjdk:21-jdk-slim
WORKDIR /app

# Copy the packaged JAR file from the 'build' stage
# The '--from=build' flag is key to the multi-stage build.
COPY --from=build /app/target/DecathlonDigitalOrders-*.jar app.jar

# Expose the port the application will run on
EXPOSE 8080

# Define the command to start your application
ENTRYPOINT ["java","-jar","/app.jar"]